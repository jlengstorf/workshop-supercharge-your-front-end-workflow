<!DOCTYPE html><html lang="en"><head><title>app/index</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="app/index"><meta name="groc-project-path" content="app/index.js"><meta name="groc-github-url" content="https://github.com/jlengstorf/workshop-supercharge-your-front-end-workflow"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/jlengstorf/workshop-supercharge-your-front-end-workflow/blob/master/app/index.js">app/index.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="indexjs">index.js</h1>
<p>This app is built with Express for easy routing and templating</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>path</code> is used to create filepaths</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Check for a port in the ENV before setting one manually</p></div></div><div class="code"><div class="wrapper">app.set(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">3000</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Views are written using Jade templates</p></div></div><div class="code"><div class="wrapper">app.set(<span class="hljs-string">'views'</span>, path.join(__dirname, <span class="hljs-string">'server/views/'</span>));
app.set(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'jade'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Create a default title</li>
</ul></div></div><div class="code"><div class="wrapper">app.title = <span class="hljs-string">'Supercharge Your Front-End Workflow'</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>To save the hassle of initializing a database, hard code some blog entries</li>
</ul></div></div><div class="code"><div class="wrapper">app.blogs = [
  {
    title: <span class="hljs-string">'Keffiyeh raw denim sustainable'</span>,
    image: <span class="hljs-string">'/img/blog-image01.jpg'</span>,
    excerpt: <span class="hljs-string">'Cray four loko gentrify, High Life Echo Park disrupt '</span> +
             <span class="hljs-string">'paleo Shoreditch Neutra put a bird on it tilde occupy '</span> +
             <span class="hljs-string">'cardigan wolf keytar. Artisan YOLO trust fund meditation '</span> +
             <span class="hljs-string">'literally PBR.'</span>,
    permalink: <span class="hljs-string">'/blog/post-one/'</span>
  },
  {
    title: <span class="hljs-string">'Intelligentsia wayfarers iPhone'</span>,
    image: <span class="hljs-string">'/img/blog-image02.jpg'</span>,
    excerpt: <span class="hljs-string">'Gluten-free trust fund sartorial pork belly literally. '</span> +
             <span class="hljs-string">'Yr hoodie swag, cornhole salvia gastropub locavore next '</span> +
             <span class="hljs-string">'level iPhone fingerstache. PBR&amp;B disrupt High Life, '</span> +
             <span class="hljs-string">'locavore drinking vinegar meggings mlkshk 3 wolf moon.'</span>,
    permalink: <span class="hljs-string">'/blog/post-two/'</span>
  },
  {
    title: <span class="hljs-string">'Art party Brooklyn listicle'</span>,
    image: <span class="hljs-string">'/img/blog-image03.jpg'</span>,
    excerpt: <span class="hljs-string">'Heirloom banh mi narwhal chambray. Neutra Echo Park '</span> +
             <span class="hljs-string">'flannel, health goth pug keytar Blue Bottle chia art '</span> +
             <span class="hljs-string">'party pickled twee Vice. Plaid photo booth next level '</span> +
             <span class="hljs-string">'sriracha hoodie gastropub, gluten-free Carles freegan.'</span>,
    permalink: <span class="hljs-string">'/blog/post-three/'</span>
  }
];</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The default route loads the home page.</p></div></div><div class="code"><div class="wrapper">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( req, res )</span> </span>{
  res.render(<span class="hljs-string">'index'</span>, { title: app.title, blogs: app.blogs });
});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To keep things simple, sub-pages are required to be letters only.</p></div></div><div class="code"><div class="wrapper">app.get(<span class="hljs-string">'/(([a-z]+))/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( req, res)</span> </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Store the page name from the URL</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> page = req.params[<span class="hljs-number">0</span>];</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Create a capitalized version of the page for the title</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> title = page.charAt(<span class="hljs-number">0</span>).toUpperCase() + page.slice(<span class="hljs-number">1</span>) + <span class="hljs-string">' | '</span> + app.title;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Create a hash of variables to send to the template</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> templateVars = {
    title: title <span class="hljs-comment">// - The title is required for all templates</span>
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>For the blog page, add the blog posts to the template variables</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (page===<span class="hljs-string">'blog'</span>) {
    templateVars.blogs = app.blogs;
  }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Render the template</li>
</ul></div></div><div class="code"><div class="wrapper">  res.render(page, templateVars, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err, html)</span> </span>{
    <span class="hljs-keyword">if</span> (err) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>If the template doesn&#39;t exist, send a 404</li>
</ul></div></div><div class="code"><div class="wrapper">      res.redirect(<span class="hljs-string">'/404/'</span>);
    } <span class="hljs-keyword">else</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Otherwise, render the template as expected</li>
</ul></div></div><div class="code"><div class="wrapper">      res.end(html);
    }
  });
});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>For blog posts, we use the slug to identify the post.
However, to keep this app front-end only, we&#39;re using hard-coded content.</p></div></div><div class="code"><div class="wrapper">app.get(<span class="hljs-string">'/blog/:slug/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( req, res )</span> </span>{

  <span class="hljs-keyword">var</span> slug = req.params.slug,
      post = {};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Loop through the blog posts to find the one matching the slug</li>
</ul></div></div><div class="code"><div class="wrapper">  app.blogs.some(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( blog )</span> </span>{
    <span class="hljs-keyword">var</span> permalink = <span class="hljs-string">'/blog/'</span> + slug + <span class="hljs-string">'/'</span>;
    <span class="hljs-keyword">if</span> (blog.permalink===permalink) {
      post = blog;
    }
  });

  res.render(<span class="hljs-string">'single'</span>, post, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( err, html)</span> </span>{
    <span class="hljs-keyword">if</span> (err) {
      res.redirect(<span class="hljs-string">'/404/'</span>);
    } <span class="hljs-keyword">else</span> {
      res.end(html);
    }
  });

});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Static files are all stored in the <code>public</code> dir</p></div></div><div class="code"><div class="wrapper">app.use(express.static(path.join(__dirname, <span class="hljs-string">'public'</span>)));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If something goes wrong with the server, send a simple message
app.use(function(err, req, res, next) {
  console.error(err.stack);
  res.status(500).send(&#39;Something broke!&#39;);</p></div></div><div class="code"><div class="wrapper"><span class="hljs-comment">// );</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Add 404 handling for pages that don&#39;t exist</p></div></div><div class="code"><div class="wrapper">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> </span>{
  res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">"The page you requested doesn't exist."</span>);
});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Start the app on port 3000</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> server = app.listen(app.get(<span class="hljs-string">'port'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(  )</span> </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'App started and listening on port %s'</span>, server.address().port);
});</div></div></div></div></body></html>